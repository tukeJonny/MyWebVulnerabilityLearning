<html>
	<head>
		<title>掲示板</title>
	</head>

	<body>
		<h1>投稿一覧</h1>
		<?php

		if($_SERVER["REQUEST_METHOD"] == "POST"){
		    writePostData();
		}

		function printPostsData() {
			try {
	    		$db = new SQLite3('posted.db');
		  	} catch (Exception $e) {
		    	return;
		  	}

		  	//発行するSQL文
		  	$sql = "SELECT * FROM posts;";

		  	// SQLの実行
		  	try {
		    	//キーワード取得部分
		    	$result = $db->query($sql);
		    	while($data = $result->fetchArray()) {
		        	print $data["name"] . ":" . $data["email"] . ":" . $data["ipaddr"] . "<br>";
		        	//print "\n";
		    	}
		  	} catch (Exception $e) {
		    	return;
		  	}
		}

		function writePostData() {
			$name = $_POST["name"];
			$email = $_POST["email"];
			$ipaddr = $_POST["ipaddr"];
			$comment = $_POST["comment"];

			try {
	    		$db = new SQLite3('posted.db');
		  	} catch (Exception $e) {
		    	return;
		  	}

		  	//発行するSQL文
		  	$sql = "INSERT INTO posts VALUES('" . $name . "', '" . $email . "', '" . $ipaddr . "', '" . $comment . "');";

		  	// SQLの実行
		  	try {
		    	$result = $db->exec($sql);
		  	} catch (Exception $e) {
		    	return;
		  	}
		}

		printPostsData();
		?>

</body>

